# Example CMakeLists.txt for a microservice with dotenv-cpp support
# Copy this to services/users/CMakeLists.txt to enable .env functionality

cmake_minimum_required(VERSION 3.10)

project(UsersServiceWithDotEnvCpp VERSION 1.0.0 LANGUAGES CXX)

# Specify the C++ standard
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED True)

# Add compile flags
set(CMAKE_CXX_FLAGS "-O2 -Wall -Wextra")

# Add include directory for common headers
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/../../src/services)

# Add executable with the example code
add_executable(users_service_with_dotenv 
    ../../src/services/users/example_with_database.cpp
)

# Link with libpqxx for PostgreSQL
target_include_directories(users_service_with_dotenv PRIVATE ${PQXX_INCLUDES})
target_link_libraries(users_service_with_dotenv ${PQXX_LIBS})

# Link with dotenv-cpp (already available via include_directories in main CMakeLists.txt)
# No additional linking needed - it's header-only!

# Link with jsoncpp for JSON support
find_package(PkgConfig REQUIRED)
pkg_check_modules(JSONCPP jsoncpp)
target_link_libraries(users_service_with_dotenv ${JSONCPP_LIBRARIES})
target_include_directories(users_service_with_dotenv PRIVATE ${JSONCPP_INCLUDE_DIRS})

# Link with static libgcc to reduce dependencies
set_target_properties(users_service_with_dotenv PROPERTIES
    LINK_FLAGS "-static-libgcc"
)

# Install target
install(TARGETS users_service_with_dotenv DESTINATION bin)